<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>æœ€å¼·ã®ç«¶é¦¬å¿…å‹ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            text-align: center;
            padding: 20px 0;
            /* ä¸Šä¸‹ã®ä½™ç™½ */
            margin: 0;
            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¼·åˆ¶çš„ã«è¨±å¯ */
            overflow-y: auto;
            min-height: 100vh;
        }

        h1 {
            font-size: clamp(2rem, 10vw, 4rem);
            font-weight: 900;
            color: #fff200;
            /* ã©ã‚®ãƒ„ã„é»„è‰² */
            text-transform: uppercase;

            /* é‡åšãªè¢‹æ–‡å­—ã¨ãƒã‚ªãƒ³ç™ºå…‰ */
            text-shadow:
                3px 3px 0 #e60012,
                -3px -3px 0 #e60012,
                3px -3px 0 #e60012,
                -3px 3px 0 #e60012,
                0 0 20px #ff0000,
                0 0 40px #ffeb3b;

            /* ãƒ‘ãƒãƒ³ã‚³å±‹ã®é›»é£¾ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            animation: neon-flicker 0.15s infinite alternate;
            margin-bottom: 30px;
            letter-spacing: -2px;
            font-style: italic;
            /* å‹¢ã„ã‚’å‡ºã™æ–œä½“ */
        }

        @keyframes neon-flicker {
            0% {
                opacity: 1;
                transform: scale(1) skewX(-5deg);
                filter: brightness(1.2);
            }

            100% {
                opacity: 0.9;
                transform: scale(1.02) skewX(-5deg);
                filter: brightness(1.5);
            }
        }

        .container {
            background: #2a2a2a;
            /* inline-blockã‚’ã‚„ã‚ã¦blockã«ã—ã€ä¸­å¤®å¯„ã›ã«ã™ã‚‹ */
            display: block;
            margin: 0 auto;
            padding: 20px;
            border-radius: 20px;
            border: 2px solid #444;
            width: 90%;
            max-width: 450px;
            /* PCã§ã®åºƒãŒã‚Šã™ãé˜²æ­¢ */
            box-sizing: border-box;
        }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã¨å…¥åŠ›æ¬„ã®èª¿æ•´ */
        select,
        input {
            font-size: 1.1rem;
            width: 100%;
            max-width: 100%;
            /* containerå†…ã«åã‚ã‚‹ */
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 12px;
            box-sizing: border-box;
            display: block;
            /* ç¸¦ã«ä¸¦ã¹ã‚‹ */
            margin-left: auto;
            margin-right: auto;
        }

        button {
            font-size: 1.5rem;
            padding: 15px;
            cursor: pointer;
            background: #e60012;
            color: #fff;
            border: none;
            border-radius: 50px;
            margin-top: 10px;
            font-weight: bold;
            width: 100%;
            transition: 0.2s;
        }

        button:hover {
            background: #ff3344;
            transform: scale(1.02);
        }

        #result {
            /* ç”»é¢å¹…ã®50%ã¾ã§å·¨å¤§åŒ–ã‚’è¨±å¯ã€æœ€å°ã§ã‚‚6rem */
            font-size: clamp(6rem, 50vw, 15rem);
            font-weight: 900;
            font-style: italic;
            /* æ–œä½“ã§å‹¢ã„ã‚’å‡ºã™ */
            margin-top: 10px;
            line-height: 1;

            /* ã©æ´¾æ‰‹ãªãƒã‚ªãƒ³ã¨è¢‹æ–‡å­— */
            color: #fff;
            text-shadow:
                0 0 10px #fff,
                0 0 20px #ffeb3b,
                0 0 40px #ff0000,
                0 0 70px #ff0000;

            /* å‡ºç¾æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 15px rgba(255, 235, 59, 0.8));
        }

        #progress-container {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            overflow: hidden;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #e60012, #ffeb3b);
        }

        #status-text {
            font-size: 0.9rem;
            color: #0f0;
            min-height: 1.2rem;
            margin-top: 10px;
        }

        .stepper {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .step-btn {
            width: 60px !important;
            /* æŠ¼ã—ã‚„ã™ã•é‡è¦– */
            height: 60px;
            margin: 0 !important;
            font-size: 1.5rem;
            background: #444 !important;
            border: 2px solid #0f0 !important;
            border-radius: 10px !important;
        }

        #total {
            flex: 1;
            max-width: 120px;
            margin: 0;
            font-size: 2rem;
        }
    </style>
</head>

<body>

    <h1>æœ€å¼·ã®ç«¶é¦¬å¿…å‹ãƒ„ãƒ¼ãƒ«</h1>

    <div class="container">
        <div class="label">é–‹å‚¬åœ°</div>
        <select id="place-selector" onchange="updateRaceList()">
            <option value="">å ´æ‰€ã‚’é¸æŠ...</option>
            <option value="æ±äº¬">æ±äº¬</option>
            <option value="ä¸­äº¬">ä¸­äº¬</option>
            <option value="å°å€‰">å°å€‰</option>
        </select>

        <div class="label">ãƒ¬ãƒ¼ã‚¹å</div>
        <select id="race-selector" onchange="syncTotal()">
            <option value="">å…ˆã«å ´æ‰€ã‚’é¸ã‚“ã§ãã ã•ã„</option>
        </select>

        <div class="label">é ­æ•°</div>
        <div class="stepper">
            <button type="button" class="step-btn" onclick="changeTotal(-1)">ï¼</button>
            <input type="number" id="total" value="16" readonly>
            <button type="button" class="step-btn" onclick="changeTotal(1)">ï¼‹</button>
        </div>

        <br>
        <button onclick="spin()">é‹å‘½ã‚’å›ã™</button>

        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="status-text"></div>
        <div id="result">-</div>
    </div>

    <script>

        const statusMessages = [
            "JRAå…¨ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è§£æä¸­...",
            "é¦¬ã®ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚’æ¸¬å®šä¸­...",
            "éä¸Šã®å‹è² æ°—é…ã‚’æ¤œçŸ¥...",
            "é‹å‘½ã®ãƒ—ãƒ­ãƒƒãƒˆã‚’è‡ªå‹•ç”Ÿæˆä¸­...",
            "æœ€çµ‚çš„ãªã€æ…‹åº¦ã€ã‚’æ±ºå®šã—ã¦ã„ã¾ã™..."
        ];

        const venueSettings = {
            "æ±äº¬": { max: 18, min: 14 },
            "ä¸­äº¬": { max: 18, min: 12 },
            "å°å€‰": { max: 18, min: 10 }
        };


        function spin() {
            const total = Number(document.getElementById('total').value);
            const res = document.getElementById('result');
            const pContainer = document.getElementById('progress-container');
            const pBar = document.getElementById('progress-bar');
            const sText = document.getElementById('status-text');
            const place = document.getElementById('place-selector').value;
            const race = document.getElementById('race-selector').value;

            // ğŸŸ¢ 1. æˆåŠŸæ™‚ã®ã€Œæ´¾æ‰‹ãªã‚¹ã‚¿ã‚¤ãƒ«ã€ã‚’ã¾ãšã‚»ãƒƒãƒˆï¼ˆåˆæœŸåŒ–ï¼‰
            res.innerText = "-";
            res.style.fontSize = ""; // CSS(clamp)ã®è¨­å®šã‚’æœ‰åŠ¹åŒ–
            res.style.color = "#fff"; // ç™½ã«æˆ»ã™
            res.style.textShadow = "0 0 10px #fff, 0 0 20px #ffeb3b, 0 0 40px #ff0000, 0 0 70px #ff0000";
            res.style.transform = "scale(1)"; // ã‚µã‚¤ã‚ºã‚’æˆ»ã™
            res.style.filter = "drop-shadow(0 0 15px rgba(255, 235, 59, 0.8))";

            // ğŸ”´ 2. ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼šæœªé¸æŠãªã‚‰ä¸Šæ›¸ãã—ã¦ä¸­æ–­
            if (!place || !race) {
                res.innerText = "é¸æŠä¸èƒ½";
                res.style.fontSize = "1.5rem"; // ã“ã“ã§ã€Œã‚·ãƒ§ãƒœãã€ã™ã‚‹
                res.style.color = "#555";
                res.style.textShadow = "none";
                res.style.filter = "none";
                sText.innerText = "âš ï¸ é–‹å‚¬åœ°ã¨ãƒ¬ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„ï¼";
                return;
            }

            // ğŸŸ¢ 3. æ¼”å‡ºé–‹å§‹
            res.style.transform = "scale(0.5)"; // æºœã‚æ¼”å‡ºã®ãŸã‚ã«ä¸€åº¦å°ã•ã
            pContainer.style.display = "block";
            pBar.style.width = "0%";

            // ãƒªã‚»ãƒƒãƒˆ
            res.innerText = "-";
            pContainer.style.display = "block";
            pBar.style.width = "0%";

            // æ®µéšã”ã¨ã®ã€Œç›®æ¨™%ã€ã¨ã€Œæ»åœ¨æ™‚é–“(ms)ã€
            const steps = [
                { pct: 20, msg: statusMessages[0], dur: 1200 },
                { pct: 40, msg: statusMessages[1], dur: 800 },
                { pct: 60, msg: statusMessages[2], dur: 600 },
                { pct: 80, msg: statusMessages[3], dur: 900 },
                { pct: 100, msg: statusMessages[4], dur: 1400 },
            ];

            let stepIndex = 0;
            let progress = 0;

            const tickMs = 50; // ãƒãƒ¼æ›´æ–°ã®ç´°ã‹ã•ï¼ˆå°ã•ã„ã»ã©ãƒŒãƒ«ãƒŒãƒ«ï¼‰
            let timer = null;

            const runStep = () => {
                const step = steps[stepIndex];
                sText.innerText = step.msg;

                const start = progress;
                const end = step.pct;
                const delta = end - start;

                const ticks = Math.max(1, Math.floor(step.dur / tickMs));
                let t = 0;

                clearInterval(timer);
                timer = setInterval(() => {
                    t++;
                    const ratio = t / ticks;

                    progress = start + delta * ratio;
                    if (progress > end) progress = end;

                    pBar.style.width = progress.toFixed(1) + "%";

                    if (t >= ticks) {
                        clearInterval(timer);
                        stepIndex++;

                        if (stepIndex < steps.length) {
                            runStep();
                        } else {
                            // å®Œäº†æ¼”å‡º
                            // å®Œäº†æ¼”å‡ºã®ã¨ã“ã‚
                            setTimeout(() => {
                                const luckyNumber = Math.floor(Math.random() * total) + 1;
                                res.innerText = luckyNumber;

                                // ğŸ’¥ è¡æ’ƒã®ã€Œç¢ºå®šã€ã‚¹ã‚¿ã‚¤ãƒ«
                                res.style.color = "#fff200"; // é»„é‡‘è‰²
                                res.style.transform = "scale(1.3) rotate(-5deg)"; // å·¨å¤§åŒ–ã—ã¦å‚¾ã‘ã‚‹

                                pContainer.style.display = "none";
                                sText.innerHTML = "<span style='color:#ffeb3b; font-weight:bold; font-size:1.5rem; text-shadow:0 0 10px #f00;'>ã€ ç¢º å®š ã€‘</span>";

                                // ãƒã‚¦ãƒ³ãƒ‰æ¼”å‡º
                                setTimeout(() => {
                                    res.style.transform = "scale(1.1) rotate(-5deg)";
                                }, 150);
                            }, 400);
                        }
                    }
                }, tickMs);
            };

            runStep();
        }


        function updateRaceList() {
            const place = document.getElementById('place-selector').value;
            const raceSelector = document.getElementById('race-selector');

            // ã‚¯ãƒªã‚¢
            raceSelector.innerHTML = '<option value="">ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ...</option>';

            if (venueSettings[place]) {
                const settings = venueSettings[place];

                // 1Rã‹ã‚‰12Rã¾ã§ã‚’ãƒ«ãƒ¼ãƒ—ã§ç”Ÿæˆ
                for (let i = 1; i <= 12; i++) {
                    // é ­æ•°ã‚’ãã‚Œã£ã½ããƒãƒ©ã‘ã•ã›ã‚‹ï¼ˆ10ã€œ18é ­ï¼‰
                    const horses = Math.floor(Math.random() * (settings.max - settings.min + 1)) + settings.min;

                    let opt = document.createElement('option');
                    opt.value = horses;
                    // 11Rã ã‘ã€Œãƒ¡ã‚¤ãƒ³ã€ã£ã½ã•ã‚’å‡ºã™æ¼”å‡ºã‚’å…¥ã‚Œã¦ã‚‚é¢ç™½ã„
                    const suffix = (i === 11) ? " (ãƒ¡ã‚¤ãƒ³)" : "";
                    opt.text = `${i}R${suffix}`;

                    raceSelector.appendChild(opt);
                }
            }
        }

        function syncTotal() {
            const raceSelector = document.getElementById('race-selector');
            document.getElementById('total').value = raceSelector.value;
        }

        function changeTotal(n) {
            const input = document.getElementById('total');
            let val = parseInt(input.value) + n;
            // ç«¶é¦¬ã®ãƒ«ãƒ¼ãƒ«ä¸Šã€2é ­ã€œ18é ­ã®ç¯„å›²ã«åˆ¶é™
            if (val < 2) val = 2;
            if (val > 18) val = 18;
            input.value = val;
        }
    </script>
</body>

</html>